# _Brain

`_brain` is a versioned logic layer for coding agents. Source of truth: `_brain_v1/`.

## What is it?
- The Cursor rule (`.cursor/rules/_brain_on.mdc`) is a dumb redirect.
- It blocks output until directives in `_brain_v1/1_directives/` are ingested.

## Entry Points
- **For Humans**: Start at [0_dna/0_dna_readme.md](_brain_v1/0_dna/0_dna_readme.md)
- **For Agents**: Enforced by `.cursor/rules/_brain_on.mdc` → `_brain_v1/1_directives/`

# Actors & Authority (stop “who edits what” confusion)

This system has **four distinct actors**. When reading any rule, always ask: *who is acting?*

- **user/human**: the repo owner/operator. They define intent (by prompt and/or config) and can edit any files in their repo.
- **AI agent**: the LLM instance executing the task. It reads `_brain_v1/` and uses tools to change the **host repo**.
- **Director (directives)**: the **runtime protocol** the agent must follow (triage, phase-lock, ingestion order, scribe). It is not a separate program; it’s the agent obeying `_brain_v1/1_directives/`.
- **Cursor runtime**: the deterministic substrate (rules + hooks). It injects/blocks context and runs hook scripts.

### Runtime write-policy (host repo)

During an **active** Brain session (hooks + directives firing), the agent’s write permissions are constrained:

- **Synapse cards** (`*_syn_*.md`, `syn_*.md`): user/human-owned library; **agent treats as read-only at runtime**.
- **Genes** (`_gene_*.md`, `gene_*.md`): DNA laws/constraints. `_gene_` ship with `_brain_v1` (system). `gene_` are optional user/human overlays. The agent treats Genes as **read-only at runtime**; shipped DNA changes only via brain transplant/evolution.
- **Homeostasis** (`_brain_v1/homeostasis.yaml`): desired operating intent (targets/policy). **Director-controlled runtime state**, derived from user/human intent. Maintained as part of normal operation (no explicit “update homeostasis” instruction required).
- **Vitals** (`_brain_v1/4_evolution/vitals.yaml`): current measured state (biomarkers/telemetry). **Machine snapshot** updated by WBC scans.
- **Memory** (`mem_*.md`): system-managed, append-only log. Written by the agent at the Scribe step; user/human typically does not edit.
- **Cursor bookkeeping** (`.cursor/cortex.yaml`, `.cursor/synaptic_state.json`): runtime-only files generated by hooks; not “Brain evolution”.

# _Brain_Transplant
- This is _brain_v1 and lives in the root of your repo project
- Do a "brain transplant" when you want to change version by swapping the entire "_brain_v1" folder for the new version. 
- Update the cursor folder (rules + hooks)







# \_brain: The Bio-Stack for AI Coding

**\_brain** is a biological operating system for your repository. It bridges the intelligence gap between human intent and AI execution by treating the codebase as a living organism.

It is **not a second codebase** or a source of truth. It is a **thin control layer**—an attention and reasoning scaffold—that sits between the user and the repo. It helps a smart but forgetful agent use its limited context window to understand how "Doing X will affect Y because of Z."

It is strictly **environment agnostic** but highly optimized for "vibe coding" with Cursor. It stores **protocols** (Markdown), not **tools**, allowing the AI (Cursor Agent) to execute logic using its own internal environment.

## Philosophy: Einstein's Goldfish

The core problem of AI coding is not intelligence; it is amnesia.

Modern LLMs are like **Einstein's Goldfish**: incredibly smart, but they possess a limited context window. In a large codebase, they forget the broader architectural intent the moment they scroll away.

`_brain` acts as the external hippocampus. It ensures that while the agent's *attention* drifts, the *intention* remains locked.

## The Superpower: The Reasoning Scaffold

The code remains the source of truth. The `_brain` provides the **connective tissue** that the raw code lacks.

* **The Code:** Defines *what* happens.

* **The Brain:** Defines *why* it happens and *how* to change it safely.

It solves the "Context Blindness" of LLMs by forcing an **Impact Analysis** step ("Y-Junction") before any skeletal change is made.

## The Bio-Stack (File Anatomy)

Every file in the brain follows a strict biological naming convention to define its operational role.

| Component | Prefix | Example | Operational Role | 
 | ----- | ----- | ----- | ----- | 
| **DNA** | `_gene_` | `_gene_1_naming.md` | Immutable Laws (shipped). "You must use snake_case." | 
| **Subconscious** | `_syn_` | `_syn_1_surgical_triage_rubric.md` | **System Logic.** Internal autonomic functions (shipped). | 
| **Conscious** | `syn_` | `syn_50_auth_flow.md` | **User Logic.** Active thoughts and project context. | 
| **Immune** | `_wbc_` | `_wbc_12_bloat_scan.md` | Defense Protocol (shipped). "Scan for bloat > 500 lines." | 
| **Symptom** | `inf_` | `inf_12_bloat_report.md` | Signal. The output report generated by a WBC scan. | 
| **Memory** | `mem_` | `mem_1_spinal_cord_hooks.md` | Append-only learned memory (system-managed: observations, decisions, drift history). |
| **Homeostasis** | (singleton) | `homeostasis.yaml` | Desired operating intent (homeostatic policy / targets). user/human-specified; Director-maintained on behalf of the user/human. |
| **Vitals** | (singleton) | `vitals.yaml` | Current measured state (biomarkers / telemetry). Machine snapshot from WBC scans. |

**Runtime Mutability (Critical):**
- The user/human can create/edit/swap `syn_*.md` freely (project-owned conscious layer). `_syn_*.md` ship with `_brain_v1` (system layer).
- During an **active** Brain session (hooks + directives), the agent must treat **all** `*_syn_*.md` and `syn_*.md` as **read-only** (no mutation).
- Protocol evolution happens **between sessions** (brain updates/transplants), not inside a live run. If a shipped protocol changes, prefer **adding a new card** (new ID) over mutating old cards in place.
- Store **declared project facts/constraints** (e.g. tech stack, code style) in **Genes** (`gene_*.md`).
- Store **learned, time-stamped observations** in **Memory** (`mem_*.md`).

## The Dual-Mind Model

The system distinguishes between **Subconscious** (System) and **Conscious** (User) operations using a standard coding convention.

* **System vs User (global rule):**

  * **Leading underscore (`_`)** means the file ships with `_brain_v1` (System).
  * **No leading underscore** means the file is user/project state (User).

* **`_syn_` (The Subconscious):**

  * **Role:** Autonomic functions (breathing, heart rate). These are the "System" files shipped with `_brain`.

  * **Sorting:** The leading underscore ensures these files float to the top of the folder structure, keeping "System" separate from "User."

  * **Safety:** Allows for safe updates. "Delete all files starting with `_`" is a safe wildcard command to upgrade the brain without wiping user memories.

* **`syn_` (The Conscious):**

  * **Role:** User-authored synapse cards (project-owned protocol modules).

  * **Sorting:** These sit comfortably below the system files.

## Token Efficiency: The Hybrid Cortex

To maximize token efficiency and eliminate "blind opens," the system uses a **Hybrid Naming** strategy. We do not use a separate index file (like a `CORTEX.md`) because it creates drift/synchronization issues. Instead, the file tree **is** the index.

**The Signal Strength Model**

* **Strict IDs (Low Signal):** `syn_45.md` requires the AI to open the file to know its contents (Wasted Tokens).

* **Hybrid Slugs (High Signal):** `syn_45_auth_flow.md` allows the AI to "sniff" the intent from the file list and only open what is relevant.

**The Naming Protocol**

* **Format:** `{prefix}{id}_{slug}.md` (prefix includes trailing underscore, e.g. `_syn_`, `_gene_`)

* **Slug Rule:** The slug must be 3-5 semantic keywords.

* **Governance:** The exact length limits and style (snake_case) are defined in `_gene_1_naming.md`.

## The Neural Network (Folder Structure)

The brain is organized into a foundational Core and four Functional Lobes.

### The Core

**`0_dna/` (The Laws):** Defines the "Self."

* **File Type:** `_gene_*.md` (System) & `gene_*.md` (User)

* **Role:** Immutable rules (e.g., naming conventions, file structure).

* **Immune System:** Contains `_wbc_*.md` (System) & `wbc_*.md` (User) White Blood Cell protocols for self-auditing.

### Specialised Lobes

**`1_directives/` (The Executive Function):** The active runtime logic.

* **File Type:** `_syn_*.md` (System) & `syn_*.md` (User)

* **Role:** The Director. Contains Triage Rubrics and Phase Lock protocols.

**`2_identity/` (The Conscience):** The project's "Soul."

* **File Type:** `syn_*.md`

* **Role:** North Star values and Anti-Goals.

**`3_context/` (The Senses):** The Map of the Current Reality.

* **File Type:** `syn_*.md`

* **Role:** File locators, drift protocols, and active patterns (pointers/maps — declared facts like tech stack live in DNA).

**`4_evolution/` (The Memory):** The historical record.

* **File Type:** `syn_*.md` (Protocols) & `mem_*.md` (Learned Memories).

* **Role:** Tracks Strategic Intent and multi-session surgeries.

## Technical Architecture

The \_brain_v1 directory sits at the root. It is environment agnostic—it stores protocols (Markdown), not tools.

```mermaid
graph TD
    DNA[0_DNA: Genes / Nature] --> Director{1_DIRECTIVES}
    
    subgraph "_brain encapsulated flow / Nurture"
        Director --> Identity[2_Identity]
        Director --> Context[3_Context]
        Identity & Context --> Audit[Logic Audit]
        
        Audit --> Decision{Strategy}
        Decision -- Fast --> Execution[Action]
        Decision -- Risk --> YJunction[Y-Junction]
        
        Execution --> Scribe[4_Evolution]
        Scribe --> Context
    end

    style DNA fill:#34322D,stroke:#34322D,color:#fff
    style Director fill:#fff,stroke:#34322D,stroke-width:2px
    style Scribe fill:#fff,stroke:#34322D
```

## Component Deep Dive

The architecture is defined by four distinct biological components, each with a specific file prefix and operational role.

### DNA (The Laws)

* **Prefix:** `_gene_` (System) / `gene_` (DNA of _Brain)

* **File Example:** `_gene_1_naming.md`

* **Biological Role:** The fundamental, immutable genetic code.

* **Operational Instruction:** "You must always use snake_case." "Never delete a file without an audit."

* **Function:** Defines the hard constraints that cannot be violated.

### Synapses (The Protocol Cards)

* **Prefix:** `_syn_` (Shipped) / `syn_` (User)

* **File Example:** `_syn_1_shipped_file_name_with_leading_underscore.md` vs `syn_45_user_added_file_name.md`

* **Biological Role:** The neural pathways formed by experience (Nurture).

* **Operational Instruction:** "Here is how the authentication flow connects to the database."

* **Function:** Stores protocol logic and stable decisions. **Do not** store mutable project facts (tech stack, code style, etc.) in synapse cards.

### Memory (Learned / Append-only)

* **Prefix:** `mem_`

* **File Example:** `mem_1_example_of_memory_file_name.md`

* **Biological Role:** Long-term memory (learned observations over time).

* **Function:** Stores learned, time-stamped project observations and context captures. Prefer adding a new `mem_*.md` entry over editing old memories.

### Immune System (The Protocol)

* **Prefix:** `_wbc_` (System) / `wbc_` (User) (White Blood Cell)

* **File Example:** `_wbc_12_bloat_scan.md`

* **Biological Role:** The defense mechanism against decay and infection.

* **Operational Instruction:** "Scan the root folder for files larger than 500 lines. If found, generate a report."

* **Function:** A pure text directive that instructs the AI to spin up its own tools (Terminal/Python) to audit the code.

### Symptoms (The Signal)

* **Prefix:** `inf_` (Inflammation)

* **File Example:** `inf_12_bloat_report.md`

* **Biological Role:** The pain signal indicating damage or disease.

* **Operational Instruction:** "List of unused variables found during WBC-12 scan."

* **Function:** The output artifact created by the AI. It alerts the human to specific "swelling" in the codebase that requires treatment.

## The Orchestration Loop

The system is activated by a master Cursor Rule configured with **`alwaysApply: true`**. This ensures the Brain's directive is automatically ingested at the start of every chat session, triggering this cognitive sequence:

### Determinism: The Spinal Cord (Cursor Hooks)

Rules are advisory. Hooks are enforcement.

- **Config (example only)**: `.cursor/hooks.example.json` (copy to `.cursor/hooks.json` in a host repo to enable)
- **Runtime**: `.cursor/spinal_cord.js`
- **Signal**: `.cursor/spinal_cord.js` digests `_brain_v1/homeostasis.yaml` → generates `.cursor/cortex.yaml` and injects a minimal cortex banner at `sessionStart`.
- **Synaptic State**: `.cursor/synaptic_state.json` is Cursor session bookkeeping to avoid re-injecting the same digest.
- **Reflexes**: Hooks deterministically block protected reads/writes and inhibited Shell/MCP operations.

1. **Ingest:** Agent reads the pointer and loads `1_directives`.

2. **Triage:** Agent grades request (Surface/Muscle/Skeletal) using `_syn_1_surgical_triage_rubric.md`.

3. **Lock:** If Skeletal, Agent enters **PHASE: ARCHITECT** (No Code).

4. **Audit:** Agent checks `3_context` and `2_identity`.

5. **Execute:** Agent enters **PHASE: SURGEON** only after gates are cleared.

6. **Scribe:** Agent updates `4_evolution` to log the decision.

## Trace Example: Running an Immune Protocol

**Trigger:** User asks: "Run Protocol 12."

1. **Read:** Agent opens `_wbc_12_bloat_scan.md`.

2. **Instruction:** "Execute recursive scan for unused vars."

3. **Action:** Agent spins up internal tools (grep/python) to run the check.

4. **Signal:** Agent creates `inf_12_bloat_report.md` (Inflammation) listing issues.

5. **Treatment:** User sees inflammation and orders a refactor.

## The Immune Response Loop

This system allows the \_brain to self-heal without storing dangerous or environment-specific scripts in the repo.

```mermaid
graph TD
    Trigger(User Trigger: 'Run Protocol 12') --> Read[Read: _wbc_12_bloat_scan.md]
    Read --> Action{Agent Action}
    
    subgraph "Ephemeral Sandbox"
        Action -- "Spins up Python/Grep" --> Audit[Execute Audit Logic]
    end
    
    Audit -- "Issue Found" --> Inflammation[Create: inf_12_bloat_report.md]
    Inflammation --> Human[Human Treatment]
```